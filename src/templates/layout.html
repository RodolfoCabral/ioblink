<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ title }} - Sistema de Gestão de Ordens de Serviço{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="logo">
            </div>
            
            <div class="sidebar-menu">
                <!-- Relatórios -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-chart-bar"></i>
                    <span class="menu-text">Relatórios</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.relatorios_diarios') }}" class="submenu-item">
                        <i class="fas fa-calendar-day"></i>
                        <span>Diários</span>
                    </a>
                    <a href="{{ url_for('main.relatorios_mensais') }}" class="submenu-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Mensais</span>
                    </a>
                    <a href="{{ url_for('main.relatorios_personalizados') }}" class="submenu-item">
                        <i class="fas fa-sliders-h"></i>
                        <span>Personalizados</span>
                    </a>
                </div>
                
                <!-- KPIs -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="menu-text">KPIs</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.kpis_desempenho') }}" class="submenu-item">
                        <i class="fas fa-chart-line"></i>
                        <span>Desempenho</span>
                    </a>
                    <a href="{{ url_for('main.kpis_manutencao') }}" class="submenu-item">
                        <i class="fas fa-tools"></i>
                        <span>Manutenção</span>
                    </a>
                    <a href="{{ url_for('main.kpis_custo') }}" class="submenu-item">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Custo</span>
                    </a>
                </div>
                
                <!-- Cadastro de Ativos -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-boxes"></i>
                    <span class="menu-text">Cadastro de Ativos</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.ativos_cadastrar') }}" class="submenu-item">
                        <i class="fas fa-plus-circle"></i>
                        <span>Cadastrar</span>
                    </a>
                    <a href="{{ url_for('main.ativos_listar') }}" class="submenu-item">
                        <i class="fas fa-list"></i>
                        <span>Listar</span>
                    </a>
                    <a href="{{ url_for('main.ativos_categorias') }}" class="submenu-item">
                        <i class="fas fa-tags"></i>
                        <span>Categorias</span>
                    </a>
                </div>
                
                <!-- Plano de Manutenção -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-clipboard-list"></i>
                    <span class="menu-text">Plano de Manutenção</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.manutencao_preventiva') }}" class="submenu-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>Preventiva</span>
                    </a>
                    <a href="{{ url_for('main.manutencao_corretiva') }}" class="submenu-item">
                        <i class="fas fa-wrench"></i>
                        <span>Corretiva</span>
                    </a>
                    <a href="{{ url_for('main.manutencao_preditiva') }}" class="submenu-item">
                        <i class="fas fa-chart-pie"></i>
                        <span>Preditiva</span>
                    </a>
                </div>
                
                <!-- Abrir Chamado -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-ticket-alt"></i>
                    <span class="menu-text">Abrir Chamado</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.chamados_novo') }}" class="submenu-item">
                        <i class="fas fa-plus"></i>
                        <span>Novo</span>
                    </a>
                    <a href="{{ url_for('main.chamados_abertos') }}" class="submenu-item">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Em Aberto</span>
                    </a>
                    <a href="{{ url_for('main.chamados_historico') }}" class="submenu-item">
                        <i class="fas fa-history"></i>
                        <span>Histórico</span>
                    </a>
                </div>
                
                <!-- Programação -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-calendar"></i>
                    <span class="menu-text">Programação</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.programacao_diaria') }}" class="submenu-item">
                        <i class="fas fa-calendar-day"></i>
                        <span>Diária</span>
                    </a>
                    <a href="{{ url_for('main.programacao_semanal') }}" class="submenu-item">
                        <i class="fas fa-calendar-week"></i>
                        <span>Semanal</span>
                    </a>
                    <a href="{{ url_for('main.programacao_mensal') }}" class="submenu-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Mensal</span>
                    </a>
                </div>
                
                <!-- Materiais -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-box-open"></i>
                    <span class="menu-text">Materiais</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.materiais_inventario') }}" class="submenu-item">
                        <i class="fas fa-warehouse"></i>
                        <span>Inventário</span>
                    </a>
                    <a href="{{ url_for('main.materiais_solicitacoes') }}" class="submenu-item">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Solicitações</span>
                    </a>
                    <a href="{{ url_for('main.materiais_fornecedores') }}" class="submenu-item">
                        <i class="fas fa-truck"></i>
                        <span>Fornecedores</span>
                    </a>
                </div>
                
                <!-- Parâmetros -->
                <div class="menu-item" onclick="toggleSubmenu(this)">
                    <i class="fas fa-cogs"></i>
                    <span class="menu-text">Parâmetros</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu">
                    <a href="{{ url_for('main.parametros_usuarios') }}" class="submenu-item">
                        <i class="fas fa-users"></i>
                        <span>Usuários</span>
                    </a>
                    <a href="{{ url_for('main.parametros_permissoes') }}" class="submenu-item">
                        <i class="fas fa-user-lock"></i>
                        <span>Permissões</span>
                    </a>
                    <a href="{{ url_for('main.parametros_sistema') }}" class="submenu-item">
                        <i class="fas fa-sliders-h"></i>
                        <span>Sistema</span>
                    </a>
                </div>
            </div>
        </nav>
        
        <!-- Conteúdo Principal -->
        <div class="main-content" id="main-content">
            <!-- Header -->
            <header class="header">
                <button class="toggle-sidebar" id="toggle-sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="user-menu">
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <img src="{{ url_for('static', filename='img/user.png') }}" alt="Avatar" class="user-avatar">
                        <span class="user-name">{{ current_user.name }}</span>
                        <i class="fas fa-chevron-down ml-2"></i>
                    </div>
                    
                    <div class="user-dropdown" id="user-dropdown">
                        <a href="{{ url_for('main.minha_conta') }}" class="dropdown-item">
                            <i class="fas fa-user"></i> Minha Conta
                        </a>
                        <a href="{{ url_for('main.suporte') }}" class="dropdown-item">
                            <i class="fas fa-question-circle"></i> Suporte
                        </a>
                        <a href="{{ url_for('auth.logout') }}" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </a>
                    </div>
                </div>
            </header>
            
            <!-- Conteúdo da Página -->
            <div class="page-content">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                {% block page_content %}{% endblock %}
            </div>
        </div>
    </div>
    
    <script>
        // Toggle submenu
        function toggleSubmenu(element) {
            const submenu = element.nextElementSibling;
            if (submenu.classList.contains('open')) {
                submenu.classList.remove('open');
            } else {
                // Fechar todos os submenus abertos
                document.querySelectorAll('.submenu.open').forEach(item => {
                    item.classList.remove('open');
                });
                submenu.classList.add('open');
            }
        }
        
        // Toggle sidebar
        document.getElementById('toggle-sidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('collapsed');
            document.getElementById('main-content').classList.toggle('expanded');
        });
        
        // Toggle user dropdown
        function toggleUserDropdown() {
            document.getElementById('user-dropdown').classList.toggle('show');
        }
        
        // Fechar dropdown ao clicar fora
        window.addEventListener('click', function(event) {
            if (!event.target.matches('.user-info') && !event.target.matches('.user-name') && !event.target.matches('.user-avatar')) {
                const dropdown = document.getElementById('user-dropdown');
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
